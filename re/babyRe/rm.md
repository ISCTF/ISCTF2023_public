## babyRe

***

出题人：D0UBL3SEV3N

![image-20240413223629829](C:\Users\26272\AppData\Roaming\Typora\typora-user-images\image-20240413223629829.png)

考点：pyinstxtractor， python 逆向

下载附件，是一个 txt 文件和一个 exe 文件。

exe 是 pyinstaller 打包 py 文件生成的 exe 文件。用 pyinstxtractor2.0 解 exe 文件。因为

pyinstxtractor1.0 解包的时候存在丢失头文件的情况。也可以手动在解 exe 下来的 题目名

称.pyc 文件添加 struct.pyc 文件头。但是使用 pyinstxtractor2.0 就不会存在上述问题。具体细节

请了解 pyc 逆向,这里不再赘述。

首先，使用 pyinstxtractor2.0 把 exe 程序解包。

![descript](C:/Users/26272/Pictures/media/4da17d936ce1e7c262d2c287f07bba72.png)

得到下面这些内容。我们着重注意 struct.pyc 和 babyRe.pyc 文件

![](C:/Users/26272/Pictures/media/e8e01614c6d3297650e4d27be3e5cd97.jpg)

载入 010，对比 strcut.pyc，看 babyRe.pyc 是否丢失文件头。对比之后没有。如果使用

pyinstxtractor1.0 就可能出现 babyRe.pyc 文件没有第一行的那些东西， 那样的话需要手动添

加。

![descript](C:/Users/26272/Pictures/media/5eb4f119253ae365c8ee328ef05e4100.png)

![descript](C:/Users/26272/Pictures/media/c8d3dbc49d45b3cf2d5889d81e7195d4.png)

然后，就是把 pyc 文件反编译为可读的 py 文件。其实可以发现这个 pyc 文件是 python3.7 版

本的，对于 3.8 版本以上的 pyc 文件， 在线网站和 uncompyle6 反编译可能会不成功。

这里就有多种方法反编译，可以在线网站反编译也可以直接 uncompyle6 去反编译。命令就是

```
uncompyle6 -o babyRe.py babyRe.pyc
```

两种方法都可以获得源码。

![descript](C:/Users/26272/Pictures/media/a897c132797dccdc748361a5bfe1d239.png)

![descript](C:/Users/26272/Pictures/media/395b24b46180f228cbdd1622531dfb92.png)

![descript](C:/Users/26272/Pictures/media/9edb294f6cae4f79544befc53ce98260.png)

![descript](C:/Users/26272/Pictures/media/9730a002c4a4b50a48e1ea4226e5ce47.png)

观察题目 py 文件可以知道，这是一道 RSA，但是题目给出的是 p+q 和（p+）\*（q+1）

推导公式：

```
令 x=p+q
令 y=(p+1)*(q+1)
y 展开：pq+p+q+1,也就是 n+x+1
那么， n=y-x-1
phi=(p-1)*(q-1)=pq-p-q+1=n-x+1
即 phi=n-x+1
```

解题脚本

```python
import libnum
from crypto.Util.number import long_to_bytes
import gmpy2
x = 292884018782106151080211087047278002613718113661882871562870811030932129300110050822187903340426820507419488984883216665816506575312384940488196435920320779296487709207011656728480651848786849994095965852212548311864730225380390740637527033103610408592664948012814290769567441038868614508362013860087396409860
y = 21292789073160227295768319780997976991300923684414991432030077313041762314144710093780468352616448047534339208324518089727210764843655182515955359309813600286949887218916518346391288151954579692912105787780604137276300957046899460796651855983154616583709095921532639371311099659697834887064510351319531902433355833604752638757132129136704458119767279776712516825379722837005380965686817229771252693736534397063201880826010273930761767650438638395019411119979149337260776965247144705915951674697425506236801595477159432369862377378306461809669885764689526096087635635247658396780671976617716801660025870405374520076160
c = 5203005542361323780340103662023144468501161788183930759975924790394097999367062944602228590598053194005601497154183700604614648980958953643596732510635460233363517206803267054976506058495592964781868943617992245808463957957161100800155936109928340808755112091651619258385206684038063600864669934451439637410568700470057362554045334836098013308228518175901113235436257998397401389511926288739759268080251377782356779624616546966237213737535252748926042086203600860251557074440685879354169866206490962331203234019516485700964227924668452181975961352914304357731769081382406940750260817547299552705287482926593175925396
e = 65537
n = y-x-1
phi = n-x+1
d = gmpy2.invert(e,phi)
m = pow(c,d,n)
print(long_to_bytes(m))

```

![descript](C:/Users/26272/Pictures/media/3fbbef877793eaa978d73b9373267fad.png)

得到flag

```
ISCTF{kisl-iopa-qdnc-tbfs-ualv}
```



